{"version":3,"file":"vue.js","sources":["../src/utils.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["/**\r\n * 判断数据类型是否为函数\r\n */\r\nexport function isFunction(val) {\r\n  return typeof val === \"function\";\r\n}\r\n\r\n/**\r\n * 判断数据是否是不为 null 的 data\r\n */\r\nexport function isObject(val) {\r\n  //   return val instanceof Object;\r\n  return typeof val === \"object\";\r\n}\r\n\r\n/**\r\n * 判断数据是否是数组\r\n */\r\nexport function isArray(val) {\r\n  return Array.isArray(val);\r\n}\r\n","let oldArrayProto = Array.prototype;\r\n// 将 oldArrayProto 变成为 arrayMethods 的原型, 而 arrayMethods 是 index 里面数组的原型, 相当于真正的原型往后推了一层, 第一层的原型只有重写的7个方法\r\nexport let arrayMethods = Object.create(oldArrayProto);\r\nconsole.log(arrayMethods);\r\nlet methods = [\"push\", \"pop\", \"shift\", \"unshift\", \"reverse\", \"sort\", \"splice\"];\r\nmethods.forEach((method) => {\r\n  arrayMethods[method] = function () {\r\n    console.log(\"重写了\" + method);\r\n    console.log(oldArrayProto[method]);\r\n    return oldArrayProto[method];\r\n  };\r\n});\r\n","import { arrayMethods } from \"./array\";\r\nimport { isObject, isArray } from \"../utils\";\r\nexport function observe(value) {\r\n  if (!isObject(value)) {\r\n    return;\r\n  }\r\n  // 观测 value 对象,实现响应式数据\r\n  return new Observer(value);\r\n}\r\n\r\nclass Observer {\r\n  // 类的构造函数\r\n  constructor(value) {\r\n    // 遍历对象, 使用 Object.defineProperty 重新定义\r\n    if (isArray(value)) {\r\n      value.__proto__ = arrayMethods;\r\n    } else {\r\n      this.walk(value);\r\n    }\r\n  }\r\n\r\n  walk(data) {\r\n    Object.keys(data).forEach((key) => {\r\n      defineReactive(data, key, data[key]);\r\n    });\r\n  }\r\n}\r\n\r\nfunction defineReactive(obj, key, value) {\r\n  // 递归劫持深层数据\r\n  observe(value);\r\n\r\n  Object.defineProperty(obj, key, {\r\n    get() {\r\n      return value;\r\n    },\r\n    set(newVal) {\r\n      if (newVal === val) return;\r\n      value = newVal;\r\n    },\r\n  });\r\n}\r\n","import { isFunction } from \"./utils\";\r\nimport { observe } from \"./observe/index\";\r\nexport function initState(vm) {\r\n  // 获取 options: _init 中已经将 options 挂在到了 vm 上\r\n  const opts = vm.$options;\r\n  // 1. data 的初始化\r\n  if (opts.data) {\r\n    initData(vm);\r\n  }\r\n  // 2. props 数据的初始化\r\n  // 3. watch 数据的初始化\r\n  // 4. computed 数据的初始化\r\n}\r\nfunction initData(vm) {\r\n  let data = vm.$options.data;\r\n  //   if (isFunction(data)) {\r\n  //     // 注意这样执行以后, this 指向的是 window\r\n  //     data = data.call(vm);\r\n  //   }\r\n\r\n  data = vm._data = isFunction(data) ? data.call(vm) : data;\r\n  //   观测数据\r\n  observe(data);\r\n  for (let key in data) {\r\n    Proxy(vm, key, \"_data\");\r\n  }\r\n}\r\n\r\nfunction Proxy(vm, key, source) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[source][key];\r\n    },\r\n    set(newVal) {\r\n      vm[source][key] = newVal;\r\n    },\r\n  });\r\n}\r\n","import { initState } from \"./state\";\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    // this 指向当前的实例\r\n    const vm = this;\r\n    // 将 Vue 实例化时用户传入的 options 暴露到 vm 实例上\r\n    this.$options = options;\r\n    console.log(this);\r\n    console.log(options);\r\n\r\n    // 状态初始化\r\n    initState(vm);\r\n\r\n    // 处理渲染数据并挂载到 el 上\r\n    if (vm.$options.el) {\r\n      console.log(\"有 el, 需要挂载\");\r\n    }\r\n  };\r\n}\r\n","import { initMixin } from \"./init\";\r\nfunction Vue(options) {\r\n  // 执行原型上的 _init 方法\r\n  this._init(options);\r\n}\r\ninitMixin(Vue);\r\n\r\nexport default Vue;\r\n"],"names":["isFunction","val","isObject","_typeof","isArray","Array","oldArrayProto","prototype","arrayMethods","Object","create","console","log","methods","forEach","method","observe","value","Observer","_classCallCheck","__proto__","walk","_createClass","key","data","keys","defineReactive","obj","defineProperty","get","set","newVal","initState","vm","opts","$options","initData","_data","call","Proxy","source","initMixin","Vue","_init","options","el"],"mappings":"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"}